/*!
 * ZUI - v1.3.0 - 2015-04-22
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2015 cnezsoft.com; Licensed MIT
 */

!function(a,b){"use strict";String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}),String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)});var c=1;c&&console.error("DEBUG ENABLED.");var d,e,f={learn:{col:1},start:{col:1},basic:{col:1},control:{col:2},component:{col:2},javascript:{col:3},view:{col:3},promotion:{col:1,row:2}},g="lastReloadAnimate",h="LAST_QUERY_ID",i="index.json",j=void 0,k="page-show-full",l={};c&&(a.dataset=l);var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F="ZUI",G=-1,H=1120,I=function(b){var c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)","i"),d=a.location.search.substr(1).match(c);return null!=d?unescape(d[2]):null},J=function(){if(!(document.body.clientWidth>=a.innerWidth)){if(0>G){var b=document.createElement("div");b.className="modal-scrollbar-measure",o.append(b),G=b.offsetWidth-b.clientWidth,o[0].removeChild(b)}if(G){var c=parseInt(o.css("padding-right")||0,10);o.css("padding-right",c+G),B.css("padding-right",G)}}},K=function(){o.css("padding-right",""),B.css("padding-right","")},L=function(a,f){var g=l[a],h=g&&g.version,j=a===i;if(!h&&e){var k=b.store.get("//"+a,null);if(null!==k){var m=b.store.get("//"+a+"::V");m&&(g={data:k,version:m},l[a]=g,h=!0,c&&console.log("Load",a,"from storage:",g))}}if(!h||!j&&g.version!==d||(c&&console.log("Load",a,"from cache:",g),f(g.data),j)){var n=a.endsWith(".json")?"json":"html";b.get(a,function(e){null!==e?(j&&(d=e.version),g={data:e,version:d},l[a]=g,b.store.set("//"+a,e),b.store.set("//"+a+"::V",d),c&&console.log("Load",a,"from remote:",g),f(e)):h&&!j&&(c&&console.log("Failed load",a,"from remote, instead load cache:",g),f(g.data))},n).error(function(){c&&console.error("Ajax error:",a),h&&!j&&(c&&console.log("Failed load",a,"from remote with error, instead load cache:",g),f(g.data))})}},M=function(a,c){var d=l[i].data;return d?(b.each(f,function(e,f){if(d.chapters[e]){b.extend(f,d.chapters[e]);var g=f.sections,h=null;return c&&(h=c(f,g),h===!1)?!1:void b.each(g,function(b,c){return a(f,c,h)===!1?!1:void 0})}}),!0):(console.error("Document index is empty."),!1)},N=function(a,b){var c=b.icon;a.attr("class","icon").text("").css("background-image",""),(void 0===c||null===c||""===c)&&(c=b.name.substr(0,1).toUpperCase()),c.startsWith("icon-")?a.addClass(c):c.endsWith(".png")?a.css("background-image","url("+c+")").addClass("with-img"):a.addClass("text-icon").text(c)},O=function(){var a=0;M(function(b,c,d){var e=b.id;c.chapter=e,c.chapterName=b.name;var f=e+"-"+c.id,g=r.clone().attr("id","section-"+f).data("section",c);g.attr({"data-id":c.id,"data-chapter":e,"data-order":a++,"data-accent":b.accent});var h=g.children(".card-heading");h.find(".name").text(c.name).attr("href","#"+e+"/"+c.id),h.children(".desc").text(c.desc),N(h.children(".icon"),c);var i=g.find(".topics");if(c.topics&&c.topics.length)for(var j in c.topics){var k=c.topics[j];k.id=j,i.append('<li data-id="'+j+'">'+k.name+"</li>")}else i.remove(".card-content"),g.addClass("without-topics");d.append(g.addClass("show"+(m?" in":"")))},function(a,b){a.$.attr("data-accent",a.accent);var c=a.$sections;return c.children().remove(),c})?(o.children(".loader").removeClass("loading"),D=q.find(".section"),m||(clearTimeout(q.data(g)),q.data(g,setTimeout(function(){D.addClass("in"),E.addClass("in")},100)),m=!0)):c&&console.error("Display sections failed.")},P=function(a,b,c){a===j&&(a=o),b===j||"down"===b?b=a.scrollTop()+.8*(p.height()-a.offset().top):"up"===b&&(b=a.scrollTop()-.8*(p.height()-a.offset().top)),a.animate({scrollTop:b},200,"swing",c)},Q=function(a){if(a){a.offset().top,a.outerHeight(),p.height(),o.scrollTop()}},R=function(a){return a===j&&(a=v),a&&a.hasClass("choosed")&&a.hasClass("show")},S=function(a,b,c){if(D){if(R(a||null)&&!c)return v=a.addClass("open"),void Q(a);var d=a&&a.hasClass("open");D.removeClass(b?"choosed":"choosed open"),a&&a.hasClass("section")&&(v=a.addClass(c&&!d?"choosed":"choosed open"),Q(a))}},T=function(){var a=D.filter(".show");if(R()){for(var b=parseInt(v.data("order")),c=v;--b>-1;){var d=a.filter('[data-order="'+b+'"]');if(d.length){c=d;break}}S(c)}else S(a.first())},U=function(){var a=D.filter(".show");if(R()){for(var b=parseInt(v.data("order")),c=v,d=D.length;b++<d;){var e=a.filter('[data-order="'+b+'"]');if(e.length){c=e;break}}S(c)}else S(a.first())},V=function(a,b,c,d){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2),2)},W=function(){var a=D.filter(".show");if(R()){var c=v.offset(),d=c.left-q.children(".container").offset().left-10;if(50>d)return void T();var e=c.top;d=c.left;var f=v,g=99999;a.each(function(){var a=b(this),c=a.offset();if(c.left+50<d){var h=V(c.left,c.top,d,e);g>h&&(f=a,g=h)}}),S(f)}else S(a.first())},X=function(){var a=D.filter(".show");if(R()){var c=v.offset(),d=q.children(".container"),e=c.left-d.offset().left-10;if(e+20+v.outerWidth()+50>=d.outerWidth())return void U();var f=c.top;e=c.left;var g=v,h=99999;a.each(function(){var a=b(this),c=a.offset();if(c.left>e){var d=V(c.left,c.top,e,f);h>d&&(g=a,h=d)}}),S(g)}else S(a.first())},Y=function(){u.removeClass("hide"),t.removeClass("hide"),D.addClass("show"),E.addClass("show"),q.data(g,setTimeout(function(){D.addClass("in"),E.addClass("in")},20)),o.removeClass("query-enabled")},Z=function(d){if(!D)return void(c&&console.log("Query failed, $sections is empty. key:",d));if(s.data("queryString")!==d&&(s.data("queryString",d).val(d),q.css("min-height",q.height())),d===j||null===d||!d.length)return void Y();o.addClass("query-enabled"),b.isFunction(ga)&&(n&&clearTimeout(n),n=setTimeout(function(){ga("send","pageview",a.location.pathname+"#search/"+d)},2e3));var e=[];if(b.each(d.split(" "),function(a,c){c=b.trim(c).toLowerCase();var d={origin:c};c.startsWith("#")?(d.type="id",d.val=c.substr(1)):c.startsWith("icon-")||c.startsWith("icon:")?(d.type="icon",d.val=c.substr(5)):c.startsWith("i:")?(d.type="icon",d.val=c.substr(1)):c.startsWith("ver:")?(d.type="version",d.val=c.substr(4)):c.startsWith("v:")?(d.type="version",d.val=c.substr(2)):c.startsWith("version:")?(d.type="version",d.val=c.substr(8)):c.startsWith("grunt:")||c.startsWith("build:")?(d.type="build",d.val=c.substr(6)):c.startsWith("g:")||c.startsWith("b:")?(d.type="build",d.val=c.substr(2)):(b.each(f,function(a){return c.startsWith(a+":")?(d.type="id",d.chapter=a,d.val=c.substr(a.length),!1):void 0}),d.type||(d.type="any",d.val=c)),d.val.length&&e.push(d)}),!e.length)return void Y();var g,h,i,k,l,m,r,t={},v={};if(M(function(a,c){i=!0,m=[],g=0,b.each(e,function(d,e){switch(l=e.val,r=null,k=!1,e.type){case"id":k=(e.chapter?a:c).id.includes(l),k&&(r=[e.chapter?"chapter":"section","id"]),g=100;break;case"icon":k="icons"===c.id,k&&(r=["section","id"]),g=100;break;default:var f=c.name.toLowerCase();if(f.includes(l)){k=!0,r=["section","name"],g=f.startsWith(l)?85:80;break}var h=a.name.toLowerCase();if(h.includes(l)){k=!0,r=["chapter","name"],g=h.startsWith(l)?75:70;break}if(l.length>1){if(c.id.includes(l)){k=!0,r=["section","id"],g=65;break}if(a.id.includes(l)){k=!0,r=["chapter","id"],g=60;break}if(b.isArray(c.topics)){var j=!1;if(b.each(c.topics,function(a,b){return b.name&&b.name.toLowerCase().includes(l)?(k=!0,r=["section","topic",a],j=!0,g=20,!1):void 0}),j)break}if(c.desc.toLowerCase().includes(l)){k=!0,r="section.desc",g=30;break}}else{if(a.id.startsWith(l)){k=!0,r=["chapter","id"],g=60;break}if(c.id.startsWith(l)){k=!0,r=["section","id"],g=50;break}}}return k?void m.push({key:e,type:r}):(i=!1,!1)}),h=a.id+"-"+c.id,i?(v[a.id]++,t[h]={hidden:!1,matches:m,weight:g}):t[h]={hidden:!0}},function(a){v[a.id]=0})){var w,x,y=b(),z=b(),A=-1;b.each(t,function(a,c){w=b("#section-"+a),c.hidden?y=y.add(w):(z=z.add(w),A<c.weight&&(x=w,A=c.weight)),S(x)});var B,E;b.each(v,function(a,b){E=f[a],B=!b,E.$.toggleClass("hide",B)});var F,G=0;u.each(function(){F=b(this);var a=F.children(".chapter:not(.hide)").length;if(F.toggleClass("hide",!a),a&&(G++,!o.hasClass("compact-mode"))){var c=F.find(".section:not(.hide)").length;c>2&&p.height()<C.height()+70*c&&(o.addClass("compact-mode"),setTimeout(function(){p.scrollTop(1),o.addClass("compact-mode-in")},10))}}),q.attr("data-show-col",G),y.length&&(y.removeClass("in"),setTimeout(function(){y.removeClass("show")},100)),z.length&&(z.addClass("show"),setTimeout(function(){z.addClass("in")},20)),p.scrollTop(1),_()}else c&&console.error("Query failed with key: ",e)},$=function(a,b){console.log("toggleCompactMode",a),a===j&&(a=!o.hasClass("compact-mode"));var c="isScrollAnimating";a?o.hasClass("compact-mode")?b&&b():(o.data(c,!0).addClass("compact-mode"),setTimeout(function(){o.addClass("compact-mode-in"),p.scrollTop(1),setTimeout(function(){o.data(c,!1),b&&b()},500)},10)):o.hasClass("compact-mode")?(o.data(c,!0).removeClass("compact-mode-in"),setTimeout(function(){o.removeClass("compact-mode"),o.data(c,!1),b&&b()},500)):b&&b()},_=function(){if(o.hasClass("page-open")){var b=w.data("trans-style");return b["max-height"]="",w.css(b),o.addClass("page-show-out").removeClass("page-open page-show-in"),a.document.title=F,a.location.hash="",setTimeout(function(){o.removeClass("page-show page-show-out"),K()},300),!0}return!1},aa=function(d,e,f){var g=e.chapter+"-"+e.id;if(o.hasClass("page-open")&&g===o.attr("data-page"))return void(c&&console.error("The page already showed."));S(d,!1,!0);var h="#"+e.chapter+"/"+e.id;f&&(h+="/"+f),console.log(e),a.document.title=e.chapterName+" > "+e.name+" - "+F,a.location.hash=h,b.isFunction(ga)&&ga("send","pageview",a.location.pathname+h),o.attr("data-page-accent",d.data("accent")).attr("data-page",g),N(x.find(".icon"),e),x.find(".name").text(e.name).attr("href",h),x.children(".desc").text(e.desc),y.html("");var i=w.addClass("loading").find(".loader").addClass("loading");return L(e.url,function(a){w.removeClass("loading"),i.removeClass("loading"),y.html(a),s.blur(),A.scrollTop(0)}),o.hasClass("page-open")?void(c&&console.log("open section in open page",e)):(o.addClass("page-open"),void $(!0,function(){var a=d.offset(),b=d.outerHeight(),c={left:a.left-q.children(".container").offset().left-6,top:a.top-p.scrollTop()-81,width:d.outerWidth(),height:b,"max-height":b};J(),o.addClass("page-show"),w.css(c).data("trans-style",c),A.css("width",H),setTimeout(function(){o.addClass("page-show-in"),w.hasClass("loading")&&w.addClass("openning").css("height",380),A.scrollTop(0),setTimeout(function(){w.removeClass("openning"),H=A.css("width","").width()+40,ca()},310)},10)}))},ba=function(d,e){d=d||v;var f;if(b.isArray(d)){var g=l[i].data;if(!(g&&d.length>1))return void(c&&console.error("Open section stop by null docIndex or wrong section value."));var h=d[1],j=g.chapters[d[0]].sections,k=!1;for(var m in j){var n=j[m];if(n.id===h){d.length>2&&(e=d[2]),d=n,k=!0;break}}if(!k)return void console.error("Open section failed: can't find the section with id "+d.join("-"))}if(b.isPlainObject(d))f=b("#section-"+d.chapter+"-"+d.id);else{var o=d;d=o.data("section"),f=o}var p=d.url;return null===p?void(c&&console.error("Open section stop by null url.")):(p||(p="part/"+d.chapter+"-"+d.id+".html",d.url=p),p=p.toLowerCase(),void(p.startsWith("http://")||p.startsWith("https://")?a.open(p,"_blank"):aa(f,d,e)))};a.openS=ba;var ca=function(){if(!o.hasClass("page-show-out")&&!w.hasClass("loading")){var a;o.hasClass(k)?(a=p.height(),A.toggleClass("with-scrollbar",y.outerHeight()>a-40-x.outerHeight())):a=Math.min(z.outerHeight(),x.outerHeight()+y.outerHeight()+50),w.css("height",a)}};b(function(){F=a.document.title;var c=function(a){a.stopPropagation()};p=b(a),o=b("body"),B=b("#navbar"),q=b("#grid"),C=b("#header"),u=q.find(".col"),w=b("#page"),x=b("#pageHeader"),z=b("#pageContainer"),y=b("#pageContent"),t=q.find(".chapter"),s=b("#searchInput"),E=q.find(".chapter-heading"),r=b("#sectionTemplate").attr("id",null),A=b("#pageBody"),b.each(f,function(a,c){a=a.toLowerCase(),c.$=b("#chapter-"+a),c.id=a,c.$sections=b("#sections-"+a)}),H=q.children(".container").outerWidth(),o.toggleClass(k,b.store.get(k,!1)),e=b.store&&b.store.enable,b.ajaxSetup({cache:!1}),L(i,function(b){var c=!m;if(O(b),!c){var d=I("q");d&&setTimeout(function(){Z(d)},300);var e=a.location.hash;e?(e=e.substr(1),setTimeout(function(){var a=e.split("/"),b=a[0].toLowerCase();"search"===b||"query"===b?Z(a[1]):ba(a)},600)):s.focus()}}),b(document).on("click",function(a){return o.hasClass("page-show")?void _():(S(),void D.removeClass("open"))}),w.on("click",c),q.on("click",".card-heading",function(a){var d=b(this).closest(".card");d.hasClass("choosed")?d.toggleClass("open"):S(d,!0),c(a)}).on("click",".card",function(a){S(b(this),!0),c(a)}).on("click",".card-heading > h5 > .name, .card-heading > .icon",function(a){ba(b(this).closest(".section")),c(a)}).on("click",".topics > li",function(a){var d=b(this);ba(d.closest(".section"),d.data("id")),c(a)}).on("mouseenter",".card-heading > h5 > .name, .card-heading > .icon",function(){b(this).closest(".card-heading").addClass("hover")}).on("mouseleave",".card-heading > h5 > .name, .card-heading > .icon",function(){b(this).closest(".card-heading").removeClass("hover")}),y.on("resize",ca),p.resize(ca),x.on("click",".path-close-btn",function(){_()}).on("click",".path-max-btn",function(){o.toggleClass(k),setTimeout(ca,300),b.store.set(k,o.hasClass(k))});var d,g=b("#navbar").outerHeight();p.on("scroll",function(a){var b=o.data("isScrollAnimating");return console.log("scroll, isScrollAnimating",b),b?void p.scrollTop(1):(d=p.scrollTop(),console.log("lastScrollTop",d),void(d>g&&!o.hasClass("compact-mode")?$(!0):!o.hasClass("page-show")&&o.hasClass("compact-mode")&&(1>d?$(!1):C.toggleClass("with-shadow",d>20))))}).on("keydown",function(a){var b=a.which,c=!o.hasClass("page-show"),d=o.hasClass("input-query-focus");13===b?c&&R()&&ba():27===b?_()||(d||s.focus(),Z()):32===b?d||(_()||(o.hasClass("compact-mode")?R()&&ba():$(!0)),a.preventDefault()):37===b?(W(),a.preventDefault()):39===b?(X(),a.preventDefault()):38===b?c?(T(),a.preventDefault()):P(A,"up"):40===b&&(c?(U(),a.preventDefault()):P(A),a.preventDefault())}),A.on("scroll",function(a){w.toggleClass("with-shadow",A.scrollTop()>20)}),s.on("change keyup paste input propertychange",function(){var a=s.val();a!==s.data("queryString")&&(clearTimeout(s.data(h)),s.data(h,setTimeout(function(){Z(a)},150)))}).on("focus",function(){o.addClass("input-query-focus"),s.val()&&!D.filter(".open").length&&S(D.filter(".show:first"))}).on("blur",function(){o.removeClass("input-query-focus")}).on("click",c),b('[data-toggle="tooltip"]').tooltip({container:"body"})})}(window,jQuery);