/*!
 * ZUI - v1.3.0 - 2015-04-23
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2015 cnezsoft.com; Licensed MIT
 */

!function(a,b){"use strict";String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}),String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)});var c=1;c&&console.error("DEBUG ENABLED.");var d,e,f={learn:{col:1},start:{col:1},basic:{col:1},control:{col:2},component:{col:2},javascript:{col:3},view:{col:3},promotion:{col:1,row:2}},g="lastReloadAnimate",h="LAST_QUERY_ID",i="index.json",j="icons.json",k=void 0,l="page-show-full",m={};c&&(a.dataset=m);var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G="ZUI",H=-1,I=1120,J=function(b){var c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)","i"),d=a.location.search.substr(1).match(c);return null!=d?unescape(d[2]):null},K=function(){if(!(document.body.clientWidth>=a.innerWidth)){if(0>H){var b=document.createElement("div");b.className="modal-scrollbar-measure",p.append(b),H=b.offsetWidth-b.clientWidth,p[0].removeChild(b)}if(H){var c=parseInt(p.css("padding-right")||0,10);p.css("padding-right",c+H),C.css("padding-right",H)}}},L=function(){p.css("padding-right",""),C.css("padding-right","")},M=function(a,f){var g=m[a],h=g&&g.version,j=a===i;if(!h&&e){var k=b.store.get("//"+a,null);if(null!==k){var l=b.store.get("//"+a+"::V");l&&(g={data:k,version:l},m[a]=g,h=!0,c&&console.log("Load",a,"from storage:",g))}}if(!h||!j&&g.version!==d||(c&&console.log("Load",a,"from cache:",g),f(g.data),j||c)){var n=a.endsWith(".json")?"json":"html";b.get(a,function(e){null!==e?(j&&(d=e.version),g={data:e,version:d},m[a]=g,b.store.set("//"+a,e),b.store.set("//"+a+"::V",d),c&&console.log("Load",a,"from remote:",g),f(e)):h&&!j&&(c&&console.log("Failed load",a,"from remote, instead load cache:",g),f(g.data))},n).error(function(){c&&console.error("Ajax error:",a),h&&!j&&(c&&console.log("Failed load",a,"from remote with error, instead load cache:",g),f(g.data))})}},N=function(a,c){var d=m[i].data;return d?(b.each(f,function(e,f){if(d.chapters[e]){b.extend(f,d.chapters[e]);var g=f.sections,h=null;return c&&(h=c(f,g),h===!1)?!1:void b.each(g,function(b,c){return a(f,c,h)===!1?!1:void 0})}}),!0):(console.error("Document index is empty."),!1)},O=function(a,b){var c=b.icon;a.attr("class","icon").text("").css("background-image",""),(void 0===c||null===c||""===c)&&(c=b.name.substr(0,1).toUpperCase()),c.startsWith("icon-")?a.addClass(c):c.endsWith(".png")?a.css("background-image","url("+c+")").addClass("with-img"):a.addClass("text-icon").text(c)},P=function(){var a=0;N(function(b,c,d){var e=b.id;c.chapter=e,c.chapterName=b.name;var f=e+"-"+c.id,g=s.clone().attr("id","section-"+f).data("section",c);g.attr({"data-id":c.id,"data-chapter":e,"data-order":a++,"data-accent":b.accent});var h=g.children(".card-heading"),i="#"+e+"/"+c.id;h.find(".name").text(c.name).attr("href",i),h.children(".desc").text(c.desc),O(h.children(".icon"),c);var j=g.find(".topics");if(c.topics&&c.topics.length)for(var k in c.topics){var l=c.topics[k];"undefined"==typeof l.id&&(l.id=k),j.append('<li data-id="'+k+'"><a href="'+i+"/"+l.id+'">'+l.name+"</a></li>")}else j.remove(".card-content"),g.addClass("without-topics");d.append(g.addClass("show"+(n?" in":"")))},function(a,b){a.$.attr("data-accent",a.accent);var c=a.$sections;return c.children().remove(),c})?(p.children(".loader").removeClass("loading"),E=r.find(".section"),n||(clearTimeout(r.data(g)),r.data(g,setTimeout(function(){E.addClass("in"),F.addClass("in")},100)),n=!0)):c&&console.error("Display sections failed.")},Q=function(a,b,c){a===k&&(a=p),b===k||"down"===b?b=a.scrollTop()+.8*(q.height()-a.offset().top):"up"===b&&(b=a.scrollTop()-.8*(q.height()-a.offset().top)),a.animate({scrollTop:b},200,"swing",c)},R=function(a){if(a){a.offset().top,a.outerHeight(),q.height(),p.scrollTop()}},S=function(a){return a===k&&(a=w),a&&a.hasClass("choosed")&&a.hasClass("show")},T=function(a,b,c){if(E){if(S(a||null)&&!c)return w=a.addClass("open"),void R(a);var d=a&&a.hasClass("open");E.removeClass(b?"choosed":"choosed open"),a&&a.hasClass("section")&&(w=a.addClass(c&&!d?"choosed":"choosed open"),R(a))}},U=function(){var a=E.filter(".show");if(S()){for(var b=parseInt(w.data("order")),c=w;--b>-1;){var d=a.filter('[data-order="'+b+'"]');if(d.length){c=d;break}}T(c)}else T(a.first())},V=function(){var a=E.filter(".show");if(S()){for(var b=parseInt(w.data("order")),c=w,d=E.length;b++<d;){var e=a.filter('[data-order="'+b+'"]');if(e.length){c=e;break}}T(c)}else T(a.first())},W=function(a,b,c,d){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2),2)},X=function(){var a=E.filter(".show");if(S()){var c=w.offset(),d=c.left-r.children(".container").offset().left-10;if(50>d)return void U();var e=c.top;d=c.left;var f=w,g=99999;a.each(function(){var a=b(this),c=a.offset();if(c.left+50<d){var h=W(c.left,c.top,d,e);g>h&&(f=a,g=h)}}),T(f)}else T(a.first())},Y=function(){var a=E.filter(".show");if(S()){var c=w.offset(),d=r.children(".container"),e=c.left-d.offset().left-10;if(e+20+w.outerWidth()+50>=d.outerWidth())return void V();var f=c.top;e=c.left;var g=w,h=99999;a.each(function(){var a=b(this),c=a.offset();if(c.left>e){var d=W(c.left,c.top,e,f);h>d&&(g=a,h=d)}}),T(g)}else T(a.first())},Z=function(){v.removeClass("hide"),u.removeClass("hide"),E.addClass("show"),F.addClass("show"),r.data(g,setTimeout(function(){E.addClass("in"),F.addClass("in")},20)),p.removeClass("query-enabled").attr("data-query","")},$=function(a){var c=b("#section-control-icons");if(!a||!a.length)return void c.removeClass("section-preview-show").data("preview",null);c.addClass("open section-preview-show");var d=c.children(".section-preview"),e=c.data("preview");d.length||(d=b('<div class="card-content section-preview icon-preview"><div class="icons"><i class="icon icon-10x"></i><i class="icon icon-5x"></i><i class="icon icon-2x"></i><i class="icon"></i></div><h3><small><i class="icon "></i></small> <span class="name color-accent"></span>  <small>Unicode: \\<span class="unicode">f3dd</span><span class="alias"> · 别名：<span class="alias-values"></span></span></small></h3><pre><code>&lt;i class=&quot;icon <span class="name"></span>&quot;&gt;&lt;/i&gt;</code></pre></div>'),c.children(".card-heading").after(d)),c.children(".section-search").find("li.active").removeClass("active"),a.addClass("active"),e&&d.find(".icon").removeClass("icon-"+e);var f=a.data("icon");c.data("preview",f.id);var g="icon-"+f.id;d.find(".icon").addClass(g),d.find(".name").text(g),d.find(".unicode").text(f.code),f.alias&&f.alias.length?d.find(".alias").removeClass("hide").find(".alias-values").text(f.alias.join(",")):d.find(".alias").addClass("hide")},_=function(a){b.isArray(a)||!a&&!a.length||(a=[a]);var c=b("#section-control-icons");p.attr("data-query","icons");var d=c.children(".section-search");d.length||(d=b('<div class="section-search card-content"><div class="loader loading"><i class="icon icon-spin icon-spinner"></i> 正在拼命加载中...</div></div>'),c.children(".card-heading").after(d),d=c.children(".section-search")),M(j,function(c){var e=d.children("ul");if(e.length||(e=b('<ul data-view="icons">'),b.each(c,function(a,c){var d=b('<li id="control-icons-'+a+'" data-id="'+a+'"><a href="#control/icons/'+a+'"><i class="icon icon-'+a+'"></i> icon-'+a+"</a></li>");c.id=a,d.data("icon",c),e.append(d)}),d.children(".loader").replaceWith(e)),!a.length)return e.children(".hide").removeClass("hide"),void $(e.children().first());for(var f in a)a[f]=a[f].toLowerCase();var g,h=0;b.each(c,function(c,d){var e=!1,f=0;c=c.toLowerCase(),b.each(a,function(a,g){var h=!1;if(c.includes(g))h=!0,f+=c.startsWith(g)?120:110;else if(d.name&&d.name.toLowerCase().includes(g))h=!0,f+=d.name.toLowerCase().startsWith(g)?100:95;else if(g.startsWith("\\")&&d.code&&d.code.toLowerCase().includes(g))h=!0,f+=120;else{var i=[];if(b.isArray(d.filter)&&d.filter.length&&(i=i.concat(d.filter)),b.isArray(d.categories)&&d.categories.length&&(i=i.concat(d.categories)),b.isArray(d.alias)&&d.alias.length&&(i=i.concat(d.alias)),!i.length)return;b.each(i,function(a,b){return b=b.toLowerCase(),b.includes(g)?(h=!0,f+=50,!1):void 0})}return h?void(e=!0):e=!1});var i=b("#control-icons-"+c).toggleClass("hide",!e);e&&f>h&&(h=f,g=i)}),$(g)})},aa=function(d){if(!E)return void(c&&console.log("Query failed, $sections is empty. key:",d));if(t.data("queryString")!==d&&(t.data("queryString",d).val(d),r.css("min-height",r.height())),d===k||null===d||!d.length)return void Z();p.addClass("query-enabled").attr("data-query",""),b.isFunction(ga)&&(o&&clearTimeout(o),o=setTimeout(function(){ga("send","pageview",a.location.pathname+"#search/"+d)},2e3));var e=[];if(b.each(d.split(" "),function(a,c){c=b.trim(c).toLowerCase();var d={origin:c};c.startsWith("#")?(d.type="id",d.val=c.substr(1)):c.startsWith("icon-")||c.startsWith("icon:")?(d.type="icon",d.val=c.substr(5)):c.startsWith("i:")?(d.type="icon",d.val=c.substr(2)):c.startsWith("ver:")?(d.type="version",d.val=c.substr(4)):c.startsWith("v:")?(d.type="version",d.val=c.substr(2)):c.startsWith("version:")?(d.type="version",d.val=c.substr(8)):c.startsWith("grunt:")||c.startsWith("build:")?(d.type="build",d.val=c.substr(6)):c.startsWith("g:")||c.startsWith("b:")?(d.type="build",d.val=c.substr(2)):(b.each(f,function(a){return c.startsWith(a+":")?(d.type="id",d.chapter=a,d.val=c.substr(a.length),!1):void 0}),d.type||(d.type="any",d.val=c)),(d.val.length||d.type&&"any"!==d.type)&&e.push(d)}),!e.length)return void Z();var g,h,i,j,l,m,n,s={},u={};if(N(function(a,c){i=!0,m=[],g=0,b.each(e,function(d,f){switch(l=f.val,n=null,j=!1,f.type){case"id":j=(f.chapter?a:c).id.includes(l),j&&(n=[f.chapter?"chapter":"section","id"]),g=100;break;case"icon":if(i="icons"===c.id){g=120,m.push({key:f,type:["section","id"]});var h=[];(f.val||f.val.length)&&h.push(f.val);for(var k in e){var o=e[k];o.val!==f.val&&(o.val||o.val.length)&&h.push(o.val)}return _(h),!1}break;default:var p=c.name.toLowerCase();if(p.includes(l)){j=!0,n=["section","name"],g=p.startsWith(l)?85:80;break}var q=a.name.toLowerCase();if(q.includes(l)){j=!0,n=["chapter","name"],g=q.startsWith(l)?75:70;break}if(l.length>1){if(c.id.includes(l)){j=!0,n=["section","id"],g=65;break}if(a.id.includes(l)){j=!0,n=["chapter","id"],g=60;break}if(b.isArray(c.topics)){var r=!1;if(b.each(c.topics,function(a,b){return b.name&&b.name.toLowerCase().includes(l)?(j=!0,n=["section","topic",a],r=!0,g=20,!1):void 0}),r)break}if(c.desc.toLowerCase().includes(l)){j=!0,n="section.desc",g=30;break}}else{if(a.id.startsWith(l)){j=!0,n=["chapter","id"],g=60;break}if(c.id.startsWith(l)){j=!0,n=["section","id"],g=50;break}}}return j?void m.push({key:f,type:n}):(i=!1,!1)}),h=a.id+"-"+c.id,i?(u[a.id]++,s[h]={hidden:!1,matches:m,weight:g}):s[h]={hidden:!0}},function(a){u[a.id]=0})){var w,x,y=b(),z=b(),A=-1;b.each(s,function(a,c){w=b("#section-"+a),c.hidden?y=y.add(w):(z=z.add(w),A<c.weight&&(x=w,A=c.weight)),T(x)});var B,C;b.each(u,function(a,b){C=f[a],B=!b,C.$.toggleClass("hide",B)});var F,G=0;v.each(function(){F=b(this);var a=F.children(".chapter:not(.hide)").length;if(F.toggleClass("hide",!a),a&&(G++,!p.hasClass("compact-mode"))){var c=F.find(".section:not(.hide)").length;c>2&&q.height()<D.height()+70*c&&(p.addClass("compact-mode"),setTimeout(function(){q.scrollTop(1),p.addClass("compact-mode-in")},10))}}),r.attr("data-show-col",G),y.length&&(y.removeClass("in"),setTimeout(function(){y.removeClass("show")},100)),z.length&&(z.addClass("show"),setTimeout(function(){z.addClass("in")},20)),q.scrollTop(1),ca()}else c&&console.error("Query failed with key: ",e)},ba=function(a,b){a===k&&(a=!p.hasClass("compact-mode"));var c="isScrollAnimating";a?p.hasClass("compact-mode")?b&&b():(p.data(c,!0).addClass("compact-mode"),setTimeout(function(){p.addClass("compact-mode-in"),q.scrollTop(1),setTimeout(function(){p.data(c,!1),b&&b()},500)},10)):p.hasClass("compact-mode")?(p.data(c,!0).removeClass("compact-mode-in"),setTimeout(function(){p.removeClass("compact-mode"),p.data(c,!1),b&&b()},500)):b&&b()},ca=function(){if(p.hasClass("page-open")){var b=x.data("trans-style");return b["max-height"]="",x.css(b),p.addClass("page-show-out").removeClass("page-open page-show-in"),a.document.title=G,a.location.hash="",setTimeout(function(){p.removeClass("page-show page-show-out"),L()},300),!0}return!1},da=function(d,e,f){var g=e.chapter+"-"+e.id;if(p.hasClass("page-open")&&g===p.attr("data-page"))return void(c&&console.error("The page already showed."));T(d,!1,!0);var h="#"+e.chapter+"/"+e.id;f&&(h+="/"+f),console.log(e),a.document.title=e.chapterName+" > "+e.name+" - "+G,a.location.hash=h,b.isFunction(ga)&&ga("send","pageview",a.location.pathname+h),p.attr("data-page-accent",d.data("accent")).attr("data-page",g),O(y.find(".icon"),e),y.find(".name").text(e.name).attr("href",h),y.find(".desc").text(e.desc),z.html("");var i=x.addClass("loading").find(".loader").addClass("loading");return M(e.url,function(a){x.removeClass("loading"),i.removeClass("loading"),z.html(a),t.blur(),B.scrollTop(0)}),p.hasClass("page-open")?void(c&&console.log("open section in open page",e)):(p.addClass("page-open"),void ba(!0,function(){var a=d.offset(),b=d.outerHeight(),c={left:Math.floor(a.left-r.children(".container").offset().left-6),top:Math.floor(a.top-q.scrollTop()-61),width:d.outerWidth(),height:b,"max-height":b};K(),p.addClass("page-show"),x.css(c).data("trans-style",c),B.css("width",I),setTimeout(function(){p.addClass("page-show-in"),x.hasClass("loading")&&x.addClass("openning").css("height",380),B.scrollTop(0),setTimeout(function(){x.removeClass("openning"),I=B.css("width","").width()+40,fa()},310)},10)}))},ea=function(d,e){d=d||w;var f;if(b.isArray(d)){var g=m[i].data;if(!(g&&d.length>1))return void(c&&console.error("Open section stop by null docIndex or wrong section value."));var h=d[1],j=g.chapters[d[0]].sections,k=!1;for(var l in j){var n=j[l];if(n.id===h){d.length>2&&(e=d[2]),d=n,k=!0;break}}if(!k)return void console.error("Open section failed: can't find the section with id "+d.join("-"))}if(b.isPlainObject(d))f=b("#section-"+d.chapter+"-"+d.id);else{var o=d;d=o.data("section"),f=o}var p=d.url;return null===p?void(c&&console.error("Open section stop by null url.")):(p||(p="part/"+d.chapter+"-"+d.id+".html",d.url=p),p=p.toLowerCase(),void(p.startsWith("http://")||p.startsWith("https://")?a.open(p,"_blank"):da(f,d,e)))};a.openS=ea;var fa=function(){if(!p.hasClass("page-show-out")&&!x.hasClass("loading")){var a;p.hasClass(l)?(a=q.height(),B.toggleClass("with-scrollbar",z.outerHeight()>a-40-y.outerHeight())):a=Math.min(A.outerHeight(),y.outerHeight()+z.outerHeight()+50),x.css("height",a)}};b(function(){G=a.document.title;var c=function(a){a.stopPropagation()};q=b(a),p=b("body"),C=b("#navbar"),r=b("#grid"),D=b("#header"),v=r.find(".col"),x=b("#page"),y=b("#pageHeader"),A=b("#pageContainer"),z=b("#pageContent"),u=r.find(".chapter"),t=b("#searchInput"),F=r.find(".chapter-heading"),s=b("#sectionTemplate").attr("id",null),B=b("#pageBody"),b.each(f,function(a,c){a=a.toLowerCase(),c.$=b("#chapter-"+a),c.id=a,c.$sections=b("#sections-"+a)}),I=r.children(".container").outerWidth(),p.toggleClass(l,b.store.get(l,!1)),e=b.store&&b.store.enable,b.ajaxSetup({cache:!1}),M(i,function(b){var c=!n;if(P(b),!c){var d=J("q");d&&setTimeout(function(){aa(d)},300);var e=a.location.hash;e?(e=e.substr(1),setTimeout(function(){var a=e.split("/"),b=a[0].toLowerCase();"search"===b||"query"===b?aa(a[1]):ea(a)},600)):t.focus()}});var d;b(document).on("click",function(a){return p.hasClass("page-show")?void ca():void(p.attr("data-query")||T())}),x.on("click",c),r.on("click",".card-heading",function(a){var d=b(this).closest(".card");d.hasClass("choosed")?d.toggleClass("open"):T(d,!0),c(a)}).on("click",".card",function(a){T(b(this),!0),c(a)}).on("click",".card-heading > h5 > .name, .card-heading > .icon",function(a){ea(b(this).closest(".section")),c(a)}).on("click",".topics > li",function(a){var d=b(this);ea(d.closest(".section"),d.data("id")),c(a)}).on("mouseenter",".card-heading > h5 > .name, .card-heading > .icon",function(){b(this).closest(".card-heading").addClass("hover")}).on("mouseleave",".card-heading > h5 > .name, .card-heading > .icon",function(){b(this).closest(".card-heading").removeClass("hover")}).on("mouseenter","#section-control-icons .section-search > ul > li > a",function(){d=b("#section-control-icons").data("preview"),$(b(this).closest("li"))}).on("mouseleave","#section-control-icons .section-search > ul > li > a",function(){d&&$(b("#control-icons-"+d))}).on("click","#section-control-icons .section-search > ul > li > a",function(){d=b(this).closest("li").data("id")}),z.on("click","section > header",function(){b(this).closest("section").toggleClass("collapsed")}).on("mouseenter","section > header",function(){b(this).closest("section").addClass("hover")}).on("mouseleave","section > header",function(){b(this).closest("section").removeClass("hover")}),z.on("resize",fa),q.resize(fa),y.on("click",".path-close-btn",function(){ca()}).on("click",".path-max-btn",function(){p.toggleClass(l),setTimeout(fa,300),b.store.set(l,p.hasClass(l))});var g,j=b("#navbar").outerHeight();q.on("scroll",function(a){var b=p.data("isScrollAnimating");return b?void q.scrollTop(1):(g=q.scrollTop(),void(g>j&&!p.hasClass("compact-mode")?ba(!0):!p.hasClass("page-show")&&p.hasClass("compact-mode")&&(1>g?ba(!1):D.toggleClass("with-shadow",g>20))))}).on("keydown",function(a){var b=a.which,c=!p.hasClass("page-show"),d=p.hasClass("input-query-focus");13===b?c&&S()&&ea():27===b?ca()||(d||t.focus(),aa()):32===b?d||(ca()||(p.hasClass("compact-mode")?S()&&ea():ba(!0)),a.preventDefault()):37===b?(X(),a.preventDefault()):39===b?(Y(),a.preventDefault()):38===b?c?(U(),a.preventDefault()):Q(B,"up"):40===b&&(c?(V(),a.preventDefault()):Q(B),a.preventDefault())}),B.on("scroll",function(a){x.toggleClass("with-shadow",B.scrollTop()>20)}),t.on("change keyup paste input propertychange",function(){var a=t.val();a!==t.data("queryString")&&(clearTimeout(t.data(h)),t.data(h,setTimeout(function(){aa(a)},150)))}).on("focus",function(){p.addClass("input-query-focus"),t.val()&&!E.filter(".open").length&&T(E.filter(".show:first"))}).on("blur",function(){p.removeClass("input-query-focus")}).on("click",c),b('[data-toggle="tooltip"]').tooltip({container:"body"})})}(window,jQuery);